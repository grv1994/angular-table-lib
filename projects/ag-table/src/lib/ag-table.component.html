<div class="table">
  <div class="btns">
    <button class="chooseColumnsBtn" mat-raised-button (click)="showColumns = !showColumns">Choose Columns</button>
    <form *ngIf="showColumns" class="chooseColumns" [formGroup]="columnsForm">
      <mat-checkbox *ngFor="let col of columnDef" [formControlName]="col.header"
        (ngModelChange)="updateColumns(col.header)">
        {{col.header}}</mat-checkbox>
    </form>
    <button class="resetBtn" mat-raised-button (click)="resetFilters()">Reset Filters</button>
    <button class="getFiltersBtn" mat-raised-button (click)="getFilters()">Get Filters</button>
  </div>

  <div class="table-container mat-elevation-z8" (mouseover)="showColumns = false">
    <mat-table [dataSource]="data" matSort>
      <ng-container *ngFor="let column of columns" [matColumnDef]="column.header">
        <th class="header" mat-header-cell *matHeaderCellDef mat-sort-header
          [ngClass]="columnTypeService.isDate(column)?'dateClass':''">
          <mat-form-field appearance="fill">
            <mat-label>{{ column.header }}</mat-label>
            <mat-select #matRef1 *ngIf="columnTypeService.isSelect(column)" multiple
              (selectionChange)="applyFilter($event,column)">
              <mat-option *ngFor="let option of column.listWithChecks" [value]="option.val"
                (click)="toggleCheckBox(column.listWithChecks, matRef1, option)">
                {{ option.val }}
              </mat-option>
            </mat-select>

            <mat-select #matRef *ngIf="columnTypeService.isRange(column)" multiple
              (selectionChange)="applyFilter($event,column)">
              <mat-option *ngFor="let option of column.listWithChecks" [value]="option.val"
                (click)="toggleCheckBox(column.listWithChecks, matRef, option)">
                {{ option.val }}
              </mat-option>
            </mat-select>
            <form *ngIf="columnTypeService.isDate(column)" [formGroup]="datesForm">
              <div *ngIf="columnTypeService.isDate(column)" class="datePicker" [ngClass]="'dateClass'">
                <mat-date-range-input [rangePicker]="picker">
                  <input matStartDate placeholder="MM/DD/YYYY" (dateChange)="onDateChange($event, 'start', column)" [formControlName]="'start'+column.header">
                  <input matEndDate placeholder="MM/DD/YYYY" (dateChange)="onDateChange($event, 'end', column)" [formControlName]="'end'+column.header">
                </mat-date-range-input>
                <mat-icon matDatepickerToggleIcon (click)="clearDate($event,column)">clear</mat-icon>
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-date-range-picker #picker></mat-date-range-picker>
              </div>
            </form>

            <input matInput *ngIf="columnTypeService.isSearch(column)"
              (keyup)="applyFilterForSearch($event.target,column)" placeholder="Search">
          </mat-form-field>
        </th>
        <td mat-cell *matCellDef="let row" [ngClass]="columnTypeService.isDate(column)?'dateClass':''">
          {{row[column.header]}}</td>
      </ng-container>

      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayedColumns;">
      </mat-row>
    </mat-table>

    <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
  </div>
</div>